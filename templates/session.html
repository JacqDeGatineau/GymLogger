<<!DOCTYPE html>
<html>
<head>
  <title>Select exercises</title>
  <link rel="stylesheet" href="/static/main.css">
</head>

<body>
  <div class="container">
  <h2>Select exercises</h2>

  <form action="/search" method="GET">
    <p>
      Search:
      <input type="text" class="input" name="query" value="{{ query or '' }}" />
      <input type="submit" class="button" value="Search" />
    </p>

    {% for sid in selected_ids %}
      {% set is_visible = namespace(found=false) %}
      {% for exercise in exercises %}
        {% if exercise.id == sid %}
          {% set is_visible.found = true %}
        {% endif %}
      {% endfor %}
      {% if not is_visible.found %}
        <input type="hidden" name="selected" value="{{ sid }}" />
      {% endif %}
    {% endfor %}

    {% if query %}
      <hr />
      <h2>Results for "{{ query }}"</h2>
      {% if exercises|length == 0 %}
        <p>No exercises found.</p>
      {% endif %}
    {% else %}
      <hr />
      <h2>All Exercises</h2>
    {% endif %}

    {% for exercise in exercises %}
      <p>
        <a href="/exercise/{{ exercise.id }}">{{ exercise.title }}</a><br />
        <a href="{{ exercise.link }}" target="_blank" rel="noopener">Guide</a><br />

        <input
          type="checkbox"
          id="exercise_{{ exercise.id }}"
          name="selected"
          value="{{ exercise.id }}"
          {% if exercise.id in selected_ids %}checked{% endif %}
        />
        <label for="exercise_{{ exercise.id }}">{{ exercise.title }}</label>
      </p>
      <hr />
    {% endfor %}

    <p>
      <input type="hidden" name="csrf_token" value="{{ session.csrf_token }}" />
      <button type="submit" class="button" formaction="/create-workout" formmethod="POST">Begin workout!</button>
    </p>
  </form>
  </div>
</body>
</html>